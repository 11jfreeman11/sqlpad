<% include header %>
<style>
    .sidebar-bottom-halfx {
        background-color: #fcfcfc;
    }
    .sidebar {
        top: 53px;
    }
    .query-editor-altview {
        top: 53px !important;
    }
</style>
<div id="panel-main" class="query-editor-altview">
            
        <div class="sidebar">
            <form>
                
                <div class="form-group">
                  <label class="control-label" for="header-query-name">Name</label>
                  <br>
                  <input id="header-query-name" name="header-query-name" class="input-query-name form-control" value="<%= query.name %>" type="text" placeholder="Query Name" >
                </div>
                
                <div class="form-group">
                  <label class="control-label" for="tags">Tags</label>
                  <br>
                  <input id="tags" name="tags" class="input-small input-mdz form-control" value="<%= query.tags || '' %>" type="text" placeholder="Tags" >
                </div>
                
                
                <input type="hidden" id="cache-key" value="<%= cacheKey %>" />
                <input type="hidden" id="query-id" name="query-id" value="<%= query._id || 'new' %>" />
                
                <button type="button" id="btn-save" class="btn btn-default" style="width: 100%">Save</button>
                <span id="btn-save-result" class="label label-info"></span>
                  
            </form>
            <hr>
            <ul class="nav nav-pills" role="tablist">
                <li class="active">
                    <a role="tab" data-toggle="tab" href="#tab-content-sql"><span class="glyphicon glyphicon-align-left"></span> SQL</a>
                </li>
                <li>
                    <a role="tab" data-toggle="tab" href="#tab-content-visualize"><span class="glyphicon glyphicon-stats"></span> Vis</a>
                </li>
            </ul>
            <hr>
            
            <div class="sidebar-bottom-half">
                <div class="side-sql-ui">
                    <div class="form-group">
                        <label class="control-label" for="connection">Connection</label>
                        <br>
                        <select id="connection" name="connection" class="input-small">
                            <option value="">Choose a Connection...</option>
                            <% navbarConnections.forEach(function(connection) { %>
                                <option value="<%= connection._id %>" <%=( connection._id === query.connectionId ? 'selected' : '') %> >
                                    <%= connection.name %>
                                </option>
                                <% }) %>
                        </select>
                        <br><br>
                        <button id="btn-run-query" class="btn btn-default btn-small" style="width: 100%">Run Query</button>
                    </div>
                    <div id="panel-db-info"></div>
                </div>
                <div class="side-vis-ui">
                    <div id="chart-setup">
                        <div class="form-group">
                            <label class="control-label">Chart Type</label>
                            <select id="chart-type-dropdown">
                                <option value=""></option>
                            </select>
                        </div>
                    </div>
                    <div id="chart-setup-ui"></div>
                    <button id="btn-visualize" class="btn btn-default btn-small" style="width: 100%">Visualize</button>
                </div>
            </div>
            
            
            
            
            
        </div> <!-- /sidebar -->
        
        
        <div class="tab-content">
            
            <div class="tab-pane active" id="tab-content-sql">
                <div class="ace-and-results" >
                    <div class="panel-editor">
                        <div id="ace-editor"><%- query.queryText || "" %></div>
                    </div>
                    <div id="panel-result">
                        <div id="panel-result-header"> 
                            <span class="panel-result-header-label">Client Run Time: </span>
                            <span class="panel-result-header-value" id="client-run-time"></span>
                            <span class="hide-while-running" style="display: none">
                                <span class="panel-result-header-label">Server Run Time: </span>
                                <span class="panel-result-header-value" id="server-run-time"></span>
                                <span class="panel-result-header-label">Rows: </span>
                                <span class="panel-result-header-value" id="rowcount"></span>
                                <span class="panel-result-header-label">Download: </span>
                                <!--<a href="#">.xlsx</a> -->
                                <a id="csv-download-link" href="/download-results/<%= cacheKey %>.csv">.csv</a>
                            </span>
                        </div>
                        <div id="result-slick-grid"></div>
                        <div id="run-result-notification"></div>
                    </div>
                </div> <!-- ace and results -->
            </div>
            
            <div class="tab-pane" id="tab-content-visualize">
                <div id="chart" style="height: 100%">
                    <svg style="height: 100%"></svg>
                </div>
            </div>
            
        </div>
        
</div>
<!-- /.panel-tabs -->
<% include footer %>